{"version":3,"file":"theme.min.js","sources":["../../../../apps/theme/theme/public/js/toolbar.js"],"sourcesContent":["frappe.ui.toolbar.Toolbar = frappe.ui.toolbar.Toolbar.extend({\r\n\r\n  setup_sidebar: function(){\r\n    var header = $('header');\r\n    var layout_side_section = $('.layout-side-section');\r\n\t\theader.find(\".toggle-sidebar\").on(\"click\", function() {\r\n\t\t\tvar overlay_sidebar = layout_side_section.find('.overlay-sidebar');\r\n\r\n\t\t\toverlay_sidebar.addClass('opened');\r\n\t\t\toverlay_sidebar.find('.reports-dropdown')\r\n\t\t\t\t.removeClass('dropdown-menu')\r\n\t\t\t\t.addClass('list-unstyled');\r\n\t\t\toverlay_sidebar.find('.dropdown-toggle')\r\n\t\t\t\t.addClass('text-muted').find('.caret')\r\n\t\t\t\t.addClass('hidden-xs hidden-sm');\r\n\r\n\t\t\t$('<div class=\"close-sidebar\">').hide().appendTo(layout_side_section).fadeIn();\r\n\r\n\t\t\tvar scroll_container = $('html');\r\n\t\t\tscroll_container.css(\"overflow-y\", \"hidden\");\r\n\r\n\t\t\tlayout_side_section.find(\".close-sidebar\").on('click', close_sidebar);\r\n\t\t\tlayout_side_section.on(\"click\", \"a:not(.dropdown-toggle)\", close_sidebar);\r\n\r\n\t\t\tfunction close_sidebar(e) {\r\n\t\t\t\tscroll_container.css(\"overflow-y\", \"\");\r\n\r\n\t\t\t\tlayout_side_section.find(\"div.close-sidebar\").fadeOut(function() {\r\n\t\t\t\t\toverlay_sidebar.removeClass('opened')\r\n\t\t\t\t\t\t.find('.dropdown-toggle')\r\n\t\t\t\t\t\t.removeClass('text-muted');\r\n\t\t\t\t\toverlay_sidebar.find('.reports-dropdown')\r\n\t\t\t\t\t\t.addClass('dropdown-menu');\r\n\t\t\t\t});\r\n      }\r\n      \r\n    });\r\n    \r\n    layout_side_section.append(\"<p>Hello</p>\")\r\n  },\r\n  setup_help: function(){\r\n\r\n  }\r\n})\r\n\r\nfrappe.views.ListGroupBy = Class.extend({\r\n  constructor(opts) {\r\n\t\t$.extend(this, opts);\r\n\t\tthis.make_wrapper();\r\n\r\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\r\n\t\tthis.group_by_fields = ['assigned_to', 'owner'];\r\n\t\tif(this.user_settings.group_by_fields) {\r\n\t\t\tthis.group_by_fields = this.group_by_fields.concat(this.user_settings.group_by_fields);\r\n\t\t}\r\n\t\tthis.render_group_by_items();\r\n\t\tthis.make_group_by_fields_modal();\r\n\t\tthis.setup_dropdown();\r\n\t\tthis.setup_filter_by();\r\n\t},\r\n\r\n\tmake_group_by_fields_modal() {\r\n\t\tlet d = new frappe.ui.Dialog ({\r\n\t\t\ttitle: __(\"Select Filters\"),\r\n\t\t\tfields: this.get_group_by_dropdown_fields()\r\n\t\t});\r\n\t\td.set_primary_action(\"Save\", ({ group_by_fields }) => {\r\n\t\t\tfrappe.model.user_settings.save(this.doctype, 'group_by_fields', group_by_fields || null);\r\n\t\t\tthis.group_by_fields = group_by_fields ? ['assigned_to', 'owner', ...group_by_fields] : ['assigned_to', 'owner'];\r\n\t\t\tthis.render_group_by_items();\r\n\t\t\td.hide();\r\n\t\t});\r\n\r\n\t\tthis.page.sidebar.find(\".add-list-group-by a \").on(\"click\", () => {\r\n\t\t\td.show();\r\n\t\t});\r\n\t},\r\n\r\n\tmake_wrapper() {\r\n\t\tthis.$wrapper = this.sidebar.sidebar.find('.list-group-by');\r\n\t\tlet html = `\r\n\t\t\t<li class=\"list-sidebar-label\">\r\n\t\t\t\t${__('Filter By')}\r\n\t\t\t</li>\r\n\t\t\t<div class=\"list-groCreatedup-by-fields\">\r\n\t\t\t</div>\r\n\t\t\t<li class=\"add-list-group-by list-link\">\r\n\t\t\t\t<a class=\"add-group-by hidden-xs text-muted\">\r\n\t\t\t\t\t${__(\"Add Fields\")} <i class=\"octicon octicon-plus\" style=\"margin-left: 2px;\"></i>\r\n\t\t\t\t</a>\r\n\t\t\t</li>\r\n\t\t`;\r\n\t\tthis.$wrapper.html(html);\r\n\t},\r\n\r\n\trender_group_by_items() {\r\n\t\tlet get_item_html = (fieldname) => {\r\n\t\t\tlet label, fieldtype;\r\n\t\t\tif (fieldname === 'assigned_to') {\r\n\t\t\t\tlabel = __('Assigned To Test');\r\n\t\t\t} else if (fieldname === 'owner') {\r\n\t\t\t\tlabel = __('Created By');\r\n\t\t\t} else {\r\n\t\t\t\tlabel = frappe.meta.get_label(this.doctype, fieldname);\r\n\t\t\t\tlet docfield = frappe.meta.get_docfield(this.doctype, fieldname);\r\n\t\t\t\tif (!docfield) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfieldtype = docfield.fieldtype;\r\n\t\t\t}\r\n\r\n\t\t\treturn `<li class=\"group-by-field list-link\">\r\n\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t<a class = \"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"\r\n\t\t\t\t\tdata-label=\"${label}\" data-fieldname=\"${fieldname}\" data-fieldtype=\"${fieldtype}\"\r\n\t\t\t\t\thref=\"#\" onclick=\"return false;\">\r\n\t\t\t\t\t\t${__(label)} <span class=\"caret\"></span>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t\t<ul class=\"dropdown-menu group-by-dropdown\" role=\"menu\">\r\n\t\t\t\t\t\t<li><div class=\"list-loading text-center group-by-loading text-muted\">\r\n\t\t\t\t\t\t\t${__(\"Loading...\")}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t</li>`;\r\n\t\t};\r\n\t\tlet html = this.group_by_fields.map(get_item_html).join('');\r\n\t\tthis.$wrapper.find('.list-group-by-fields').html(html);\r\n\t},\r\n\r\n\tsetup_dropdown() {\r\n\t\tthis.$wrapper.on('click', '.group-by-field', (e)=> {\r\n\t\t\tlet dropdown = $(e.currentTarget).find('.group-by-dropdown');\r\n\t\t\tlet fieldname = $(e.currentTarget).find('a').attr('data-fieldname');\r\n\t\t\tlet fieldtype = $(e.currentTarget).find('a').attr('data-fieldtype');\r\n\t\t\tthis.get_group_by_count(fieldname).then(field_count_list => {\r\n\t\t\t\tif (field_count_list.length) {\r\n\t\t\t\t\tthis.render_dropdown_items(field_count_list, fieldtype, dropdown);\r\n\t\t\t\t\tthis.sidebar.setup_dropdown_search(dropdown, '.group-by-value');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdropdown.find('.group-by-loading').html(`${__(\"No filters found\")}`);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tget_group_by_dropdown_fields() {\r\n\t\tlet group_by_fields = [];\r\n\t\tlet fields = this.list_view.meta.fields.filter((f)=> [\"Select\", \"Link\", \"Data\", \"Int\", \"Check\"].includes(f.fieldtype));\r\n\t\tgroup_by_fields.push({\r\n\t\t\tlabel: __(this.doctype),\r\n\t\t\tfieldname: 'group_by_fields',\r\n\t\t\tfieldtype: 'MultiCheck',\r\n\t\t\tcolumns: 2,\r\n\t\t\toptions: fields\r\n\t\t\t\t.map(df => ({\r\n\t\t\t\t\tlabel: __(df.label),\r\n\t\t\t\t\tvalue: df.fieldname,\r\n\t\t\t\t\tchecked: this.group_by_fields.includes(df.fieldname)\r\n\t\t\t\t}))\r\n\t\t});\r\n\t\treturn group_by_fields;\r\n\t},\r\n\r\n\tget_group_by_count(field) {\r\n\t\tlet current_filters = this.list_view.get_filters_for_args();\r\n\r\n\t\t// remove filter of the current field\r\n\t\tcurrent_filters =\r\n\t\t\tcurrent_filters.filter((f_arr) => !f_arr.includes(field === 'assigned_to' ? '_assign': field));\r\n\r\n\t\tlet args =  {\r\n\t\t\tdoctype: this.doctype,\r\n\t\t\tcurrent_filters: current_filters,\r\n\t\t\tfield: field,\r\n\t\t};\r\n\r\n\r\n\t\treturn frappe.call('frappe.desk.listview.get_group_by_count', args).then((r) => {\r\n\t\t\tlet field_counts = r.message || [];\r\n\t\t\tfield_counts = field_counts.filter(f => f.count !== 0);\r\n\t\t\tlet current_user = field_counts.find(f => f.name === frappe.session.user);\r\n\t\t\tfield_counts = field_counts.filter(f => !['Guest', 'Administrator', frappe.session.user].includes(f.name));\r\n\t\t\t// Set frappe.session.user on top of the list\r\n\t\t\tif (current_user) field_counts.unshift(current_user);\r\n\t\t\treturn field_counts;\r\n\t\t});\r\n\t},\r\n\r\n\trender_dropdown_items(fields, fieldtype, dropdown) {\r\n\t\tlet get_dropdown_html = (field) => {\r\n\t\t\tlet label = field.name == null ? __('Not Specified') : field.name;\r\n\t\t\tif (label === frappe.session.user) {\r\n\t\t\t\tlabel = __('Me');\r\n\t\t\t} else if (fieldtype && fieldtype == 'Check') {\r\n\t\t\t\tlabel = label == '0'? __('No'): __('Yes');\r\n\t\t\t}\r\n\t\t\tlet value = field.name == null ? '' : encodeURIComponent(field.name);\r\n\r\n\t\t\treturn `<li class=\"group-by-item\" data-value=\"${value}\">\r\n\t\t\t\t<a class=\"badge-hover\" href=\"#\" onclick=\"return false;\">\r\n\t\t\t\t\t<span class=\"group-by-value\" data-name=\"${field.name}\">${label}</span>\r\n\t\t\t\t\t<span class=\"badge pull-right group-by-count\">${field.count}</span>\r\n\t\t\t\t</a>\r\n\t\t\t</li>`;\r\n\t\t};\r\n\t\tlet standard_html = `\r\n\t\t\t<div class=\"dropdown-search\">\r\n\t\t\t\t<input type=\"text\" placeholder=\"${__('Search')}\" class=\"form-control dropdown-search-input input-xs\">\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tlet dropdown_html = standard_html + fields.map(get_dropdown_html).join('');\r\n\t\tdropdown.html(dropdown_html);\r\n\t},\r\n\r\n\tsetup_filter_by() {\r\n\t\tthis.$wrapper.on('click', '.group-by-item', (e) => {\r\n\t\t\tlet $target = $(e.currentTarget);\r\n\t\t\tlet fieldname = $target.parents('.group-by-field').find('a').data('fieldname');\r\n\t\t\tlet value = typeof $target.data('value') === 'string'\r\n\t\t\t\t? decodeURIComponent($target.data('value').trim())\r\n\t\t\t\t: $target.data('value');\r\n\t\t\tfieldname = fieldname === 'assigned_to' ? '_assign': fieldname;\r\n\r\n\t\t\treturn this.list_view.filter_area.remove(fieldname)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tlet operator = '=';\r\n\t\t\t\t\tif (value === '') {\r\n\t\t\t\t\t\toperator = 'is';\r\n\t\t\t\t\t\tvalue = 'not set';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fieldname === '_assign') {\r\n\t\t\t\t\t\toperator = 'like';\r\n\t\t\t\t\t\tvalue = `%${value}%`;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn this.list_view.filter_area.add(this.doctype, fieldname, operator, value);\r\n\t\t\t\t});\r\n\t\t});\r\n\t},\r\n})"],"names":["frappe","ui","toolbar","Toolbar","extend","setup_sidebar","header","$","layout_side_section","find","on","overlay_sidebar","addClass","removeClass","hide","appendTo","fadeIn","scroll_container","close_sidebar","e","css","fadeOut","append","setup_help","views","ListGroupBy","Class","constructor","opts","this","make_wrapper","user_settings","get_user_settings","doctype","group_by_fields","concat","render_group_by_items","make_group_by_fields_modal","setup_dropdown","setup_filter_by","d","Dialog","title","__","fields","get_group_by_dropdown_fields","set_primary_action","ref","model","save","page","sidebar","show","$wrapper","let","html","map","fieldname","label","fieldtype","meta","get_label","docfield","get_docfield","join","dropdown","currentTarget","attr","get_group_by_count","then","field_count_list","length","render_dropdown_items","setup_dropdown_search","list_view","filter","f","includes","push","columns","options","df","value","checked","field","current_filters","get_filters_for_args","f_arr","args","call","r","field_counts","message","current_user","count","name","session","user","unshift","dropdown_html","encodeURIComponent","$target","parents","data","decodeURIComponent","trim","filter_area","remove","operator","add"],"mappings":"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"}