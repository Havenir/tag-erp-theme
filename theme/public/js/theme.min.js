!function(){"use strict";frappe.ui.toolbar.Toolbar=frappe.ui.toolbar.Toolbar.extend({setup_sidebar:function(){var t=$("header"),e=$(".layout-side-section");t.find(".toggle-sidebar").on("click",function(){var t=e.find(".overlay-sidebar");t.addClass("opened"),t.find(".reports-dropdown").removeClass("dropdown-menu").addClass("list-unstyled"),t.find(".dropdown-toggle").addClass("text-muted").find(".caret").addClass("hidden-xs hidden-sm"),$('<div class="close-sidebar">').hide().appendTo(e).fadeIn();var n=$("html");function i(i){n.css("overflow-y",""),e.find("div.close-sidebar").fadeOut(function(){t.removeClass("opened").find(".dropdown-toggle").removeClass("text-muted"),t.find(".reports-dropdown").addClass("dropdown-menu")})}n.css("overflow-y","hidden"),e.find(".close-sidebar").on("click",i),e.on("click","a:not(.dropdown-toggle)",i)}),e.append("<p>Hello</p>")},setup_help:function(){}}),frappe.views.ListGroupBy=Class.extend({constructor:function(t){$.extend(this,t),this.make_wrapper(),this.user_settings=frappe.get_user_settings(this.doctype),this.group_by_fields=["assigned_to","owner"],this.user_settings.group_by_fields&&(this.group_by_fields=this.group_by_fields.concat(this.user_settings.group_by_fields)),this.render_group_by_items(),this.make_group_by_fields_modal(),this.setup_dropdown(),this.setup_filter_by()},make_group_by_fields_modal:function(){var t=this,e=new frappe.ui.Dialog({title:__("Select Filters"),fields:this.get_group_by_dropdown_fields()});e.set_primary_action("Save",function(n){var i=n.group_by_fields;frappe.model.user_settings.save(t.doctype,"group_by_fields",i||null),t.group_by_fields=i?["assigned_to","owner"].concat(i):["assigned_to","owner"],t.render_group_by_items(),e.hide()}),this.page.sidebar.find(".add-list-group-by a ").on("click",function(){e.show()})},make_wrapper:function(){this.$wrapper=this.sidebar.sidebar.find(".list-group-by");var t='\n\t\t\t<li class="list-sidebar-label">\n\t\t\t\t'+__("Filter By")+'\n\t\t\t</li>\n\t\t\t<div class="list-groCreatedup-by-fields">\n\t\t\t</div>\n\t\t\t<li class="add-list-group-by list-link">\n\t\t\t\t<a class="add-group-by hidden-xs text-muted">\n\t\t\t\t\t'+__("Add Fields")+' <i class="octicon octicon-plus" style="margin-left: 2px;"></i>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t';this.$wrapper.html(t)},render_group_by_items:function(){var t=this,e=this.group_by_fields.map(function(e){var n,i;if("assigned_to"===e)n=__("Assigned To Test");else if("owner"===e)n=__("Created By");else{n=frappe.meta.get_label(t.doctype,e);var s=frappe.meta.get_docfield(t.doctype,e);if(!s)return;i=s.fieldtype}return'<li class="group-by-field list-link">\n\t\t\t\t<div class="btn-group">\n\t\t\t\t\t<a class = "dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\n\t\t\t\t\tdata-label="'+n+'" data-fieldname="'+e+'" data-fieldtype="'+i+'"\n\t\t\t\t\thref="#" onclick="return false;">\n\t\t\t\t\t\t'+__(n)+' <span class="caret"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class="dropdown-menu group-by-dropdown" role="menu">\n\t\t\t\t\t\t<li><div class="list-loading text-center group-by-loading text-muted">\n\t\t\t\t\t\t\t'+__("Loading...")+"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</li>"}).join("");this.$wrapper.find(".list-group-by-fields").html(e)},setup_dropdown:function(){var t=this;this.$wrapper.on("click",".group-by-field",function(e){var n=$(e.currentTarget).find(".group-by-dropdown"),i=$(e.currentTarget).find("a").attr("data-fieldname"),s=$(e.currentTarget).find("a").attr("data-fieldtype");t.get_group_by_count(i).then(function(e){e.length?(t.render_dropdown_items(e,s,n),t.sidebar.setup_dropdown_search(n,".group-by-value")):n.find(".group-by-loading").html(""+__("No filters found"))})})},get_group_by_dropdown_fields:function(){var t=this,e=[],n=this.list_view.meta.fields.filter(function(t){return["Select","Link","Data","Int","Check"].includes(t.fieldtype)});return e.push({label:__(this.doctype),fieldname:"group_by_fields",fieldtype:"MultiCheck",columns:2,options:n.map(function(e){return{label:__(e.label),value:e.fieldname,checked:t.group_by_fields.includes(e.fieldname)}})}),e},get_group_by_count:function(t){var e=this.list_view.get_filters_for_args();e=e.filter(function(e){return!e.includes("assigned_to"===t?"_assign":t)});var n={doctype:this.doctype,current_filters:e,field:t};return frappe.call("frappe.desk.listview.get_group_by_count",n).then(function(t){var e=t.message||[],n=(e=e.filter(function(t){return 0!==t.count})).find(function(t){return t.name===frappe.session.user});return e=e.filter(function(t){return!["Guest","Administrator",frappe.session.user].includes(t.name)}),n&&e.unshift(n),e})},render_dropdown_items:function(t,e,n){var i='\n\t\t\t<div class="dropdown-search">\n\t\t\t\t<input type="text" placeholder="'+__("Search")+'" class="form-control dropdown-search-input input-xs">\n\t\t\t</div>\n\t\t'+t.map(function(t){var n=null==t.name?__("Not Specified"):t.name;return n===frappe.session.user?n=__("Me"):e&&"Check"==e&&(n="0"==n?__("No"):__("Yes")),'<li class="group-by-item" data-value="'+(null==t.name?"":encodeURIComponent(t.name))+'">\n\t\t\t\t<a class="badge-hover" href="#" onclick="return false;">\n\t\t\t\t\t<span class="group-by-value" data-name="'+t.name+'">'+n+'</span>\n\t\t\t\t\t<span class="badge pull-right group-by-count">'+t.count+"</span>\n\t\t\t\t</a>\n\t\t\t</li>"}).join("");n.html(i)},setup_filter_by:function(){var t=this;this.$wrapper.on("click",".group-by-item",function(e){var n=$(e.currentTarget),i=n.parents(".group-by-field").find("a").data("fieldname"),s="string"==typeof n.data("value")?decodeURIComponent(n.data("value").trim()):n.data("value");return i="assigned_to"===i?"_assign":i,t.list_view.filter_area.remove(i).then(function(){var e="=";return""===s&&(e="is",s="not set"),"_assign"===i&&(e="like",s="%"+s+"%"),t.list_view.filter_area.add(t.doctype,i,e,s)})})}})}();
//# sourceMappingURL=theme.min.js.map
